{% load cache %}
{% extends 'mailing_app/base.html' %}

{% block title %}Рассылки{% endblock %}

{% block content %}
<h1 class="mb-4">Список рассылок</h1>
<a href="{% url 'mailing_create' %}" class="btn btn-success mb-3">Создать рассылку</a>

{% cache 300 mailing_table user.id %}
<table class="table table-bordered table-striped">
  <thead class="table-dark">
    <tr>
      <th>Сообщение</th>
      <th>Клиенты</th>
      <th>Статус</th>
      <th>Начало</th>
      <th>Окончание</th>
      <th>Действия</th>
    </tr>
  </thead>
  <tbody>
    {% for mailing in mailings %}
    <tr>
      <td>{{ mailing.message.subject }}</td>
      <td>
        {% for client in mailing.clients.all %}
          {{ client.email }}{% if not forloop.last %}, {% endif %}
        {% endfor %}
      </td>
      <td>{{ mailing.status }}</td>
      <td>{{ mailing.start_time }}</td>
      <td>{{ mailing.end_time }}</td>
      <td>
        <a href="{% url 'mailing_update' mailing.pk %}" class="btn btn-sm btn-primary">Редактировать</a>
        <a href="{% url 'mailing_delete' mailing.pk %}" class="btn btn-sm btn-danger">Удалить</a>
        <a href="{% url 'mailing_send' mailing.pk %}" class="btn btn-sm btn-warning">Отправить</a>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endcache %}
{% endblock %}
